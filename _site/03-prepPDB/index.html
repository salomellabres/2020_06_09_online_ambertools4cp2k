















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-06-09 11:46:46 +0100">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons//apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons//apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons//apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons//apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons//apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons//apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons//apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons//apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons//favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons//favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons//favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons//favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons//favicon-128.png" sizes="128x128" />
    <meta name="application-name" content=" - Preparing to run biomolecular QM/MM simulations with CP2K using AmberTools"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons//mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons//mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons//mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons//mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons//mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Preparing your PDB file &ndash; Preparing to run biomolecular QM/MM simulations with CP2K using AmberTools
  </title>  

  </head>
  <body>

    



    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-overview/index.html">Overview of AmberTools20</a></li>
            
            <li><a href="../02-setup/index.html">Log in and environment set up in ARCHER</a></li>
            
            <li><a href="../03-prepPDB/index.html">Preparing your PDB file</a></li>
            
            <li><a href="../04-parameters/index.html">Parameterising your ligands</a></li>
            
            <li><a href="../05-leap/index.html">System set up</a></li>
            
            <li><a href="../06-minimisation/index.html">Energy minimisation</a></li>
            
            <li><a href="../07-therm/index.html">Thermalisation and Density equilibration</a></li>
            
            <li><a href="../08-parmed/index.html">Adding missing LJ parameters and recentering coordinates</a></li>
            
            <li><a href="../09-qmmm/index.html">QM/MM monitorisation runs</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../amber/index.html">Amber Input Files</a></li>
            
            <li><a href="../cp2k/index.html">CP2K Input Files</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit//_episodes/03-prepPDB.md" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-setup/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Preparing to run biomolecular QM/MM simulations with CP2K using AmberTools</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-parameters/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Preparing your PDB file</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 15 min
      <br/>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What should I check before preparing a simulation?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Read the literature on your biological system.</p>
</li>
	
	<li><p>Set the experimental conditions of your simulation (pH, …).</p>
</li>
	
	<li><p>Assess the protonation states of your system (including all the elements in it: protein and ligand).</p>
</li>
	
	<li><p><code class="language-plaintext highlighter-rouge">PROPKA</code> calculates the pKa values for each of the residues in your protein.</p>
</li>
	
	<li><p>Marvinsketch will assist you in predicting the protonation state for your small molecule.</p>
</li>
	
	<li><p>Add hydrogen atoms to the GWS ligand with <code class="language-plaintext highlighter-rouge">openbabel</code>.</p>
</li>
	
	<li><p>Prepare your protein with <code class="language-plaintext highlighter-rouge">pdb4amber</code>.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="understanding-your-pdb-file">Understanding your PDB file</h2>

<p>We are going to use the X-ray structure of Mpro protein bound to a ligand from the PanDDA library. The PDB id we are going to use is <a href="http://www.rcsb.org/structure/5R84">5R84</a>. If you open this entry from the <a href="https://www.rcsb.org">Protein DataBank</a> you will find a lot of information of the protein structure:</p>
<ul>
  <li>Experimental Data Snapshot</li>
  <li>wwPDB Validation</li>
  <li>Literature</li>
  <li>Macromolecules</li>
  <li>Small Molecules</li>
  <li>Experimental Data &amp; Validation</li>
  <li>Entry History</li>
</ul>

<p><img src="../fig/PDBpage.png" alt="Snapshot of PDB page 5R84" /></p>

<p>We are interested in the quality of the structure and the contents of the structure:</p>
<ul>
  <li><strong>Experimental Data Snapshot</strong> and <strong>wwPDB Validation</strong> give us information about the quality of the model. In this case, the X-ray structure is not so great but this fragment screening was resolved really fast to enable computational efforts. In any case, it will have to do for the purpose of this workshop. For more information you can check out the Bioexcel webinar on <a href="https://bioexcel.eu/webinar-10-assessing-structure-quality-in-the-pdb-archive/">Assessing structure quality in the PDB archive</a>.</li>
  <li>The sections <strong>Macromolecules</strong> and <strong>Small Molecules</strong> give us information about the contents of the PDB file. We can see that there is only one macromolecule (only one chain) that corresponds to SARS-CoV-2 main protease. There are two small molecules in the structure: DMS and GWS.
    <ul>
      <li>DMS is a crystallisation product and it doesn’t interest us.</li>
      <li>GWS is the fragment we want to model.</li>
    </ul>
  </li>
</ul>

<p>Once we know which molecules from the PDB file we want to model and which should be deleted from the PDB file, we can continue. 
You can download the PDB file from the website yourself or use the one we are providing in this repository.</p>

<hr />

<h2 id="splitting-the-pdb-in-protein-ligand-and-water-molecules">Splitting the PDB in protein, ligand and water molecules</h2>

<p>First, we will split the PDB in 3 different groups: protein, GWS ligand and water molecules as we need to treat them separately:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="nt">-v</span> <span class="nt">-e</span> <span class="s2">"GWS"</span> <span class="nt">-e</span> <span class="s2">"DMS"</span> <span class="nt">-e</span> <span class="s2">"CONECT"</span> <span class="nt">-e</span> <span class="s2">"HOH"</span> 5r84.pdb <span class="o">&gt;</span>  protein.pdb
<span class="nb">grep</span> <span class="s2">"GWS"</span> 5r84.pdb <span class="o">&gt;</span> GWS.pdb
<span class="nb">grep</span> <span class="s2">"HOH"</span> 5r84.pdb <span class="o">&gt;</span> waters.pdb
</code></pre></div></div>

<p><img src="../fig/fullsystem.png" alt="PDB contents split in three groups" /></p>

<hr />

<h2 id="replicating-the-experimentaltarget-conditions">Replicating the experimental/target conditions</h2>

<p>It is important to take into account experimental conditions of the system we want to simulate such as the pH, salinity… Since Mpro protein from SARS-CoV2 is located in the cytosol of the infected human cell, we are going to assume a <strong>pH=7.4</strong>. Do not asume that will always be the case in the future, you should always, please check the literature on your target protein before you start running your simulations.</p>

<hr />

<h3 id="assessing-the-protonation-states-of-the-protein-and-preparing-the-protein-for-ambertools">Assessing the protonation states of the protein and preparing the protein for AmberTools</h3>

<p>There are several methods to assess the protonation state of the residues in a protein (for further information, <a href="https://en.wikipedia.org/wiki/Protein_pKa_calculations">here</a>). For example, the <a href="http://biophysics.cs.vt.edu">H++ server</a> and <a href="http://propka.org">PROPKA</a> software can help you in the future. We are only going to use PROPKA command-line in this workshop.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>propka31 protein.pdb 
</code></pre></div></div>

<p>PROPKA returns the calculated pKa values for tritable residues in the protein. These are aminoacids, whose sidechain contains a chemical moiety that can change its protonation state depending on the pH of the environment they are found in. You have acidic residues (typically ASP and GLU, but in extreme environments TYR, SER and CYS can act as acids) and basic residues (LYS, ARG and HIS).</p>

<p>Protein forcefield encode these protonation states as different residue names (i.e. GLU and GLH for the two states of glutamic acid). You can find more information about these residues, and how its pKa depends on the chemical environment <a href="https://software.acellera.com/docs/latest/htmd/tutorials/protein-preparation.html">here</a> .</p>

<p>When preparing a protein, we have to compare each one of the predicted  pKa values with the chosen pH: if the pKa is below the chosen pH the residue should be deprotonated (that is acidic residues will be negatively charged and basic residues will be neutral), if above it will be protonated (acidic residues will be neutral and basic residues will be positively charged).</p>

<blockquote class="callout">
  <h2 id="tip">TIP:</h2>

  <p>This step is especially relevant when you are simulating catalytic cycles, where the reaction mechanism often involves proton transfer events. Please check the literature on your target protein before you start to run your simulations.</p>
</blockquote>

<p>This is the summary of the propKa output for our protein:</p>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--------------------------------------------------------------------------------------------------------
SUMMARY OF THIS PREDICTION
       Group      pKa  model-pKa   ligand atom-type
   ASP  33 A     3.79       3.80
   ASP  34 A     3.63       3.80
   ASP  48 A     2.69       3.80
   ASP  56 A     4.00       3.80
   ASP  92 A     3.11       3.80
   ASP 153 A     3.91       3.80
   ASP 155 A     3.00       3.80
   ASP 176 A     3.90       3.80
   ASP 187 A     3.97       3.80
   ASP 197 A     2.33       3.80
   GLU  14 A     4.00       4.50
   GLU  47 A     4.67       4.50
   GLU  55 A     4.73       4.50
   GLU 166 A     3.98       4.50
   GLU 178 A     4.88       4.50
   HIS  41 A     4.60       6.50
   HIS  64 A     6.26       6.50
   HIS  80 A     5.71       6.50
   HIS 163 A     2.07       6.50
   HIS 164 A     1.44       6.50
   HIS 172 A     5.57       6.50
   CYS  16 A    11.91       9.00
   CYS  22 A    10.26       9.00
   CYS  38 A    12.83       9.00
   CYS  44 A    11.04       9.00
   CYS  85 A    11.68       9.00
   CYS 117 A    11.97       9.00
   CYS 128 A    11.33       9.00
   CYS 145 A    11.82       9.00
   CYS 156 A     9.45       9.00
   CYS 160 A    12.93       9.00
   TYR  37 A    11.88      10.00
   TYR  54 A    15.15      10.00
   TYR 101 A    12.87      10.00
   TYR 118 A    10.28      10.00
   TYR 126 A    12.67      10.00
   TYR 154 A    10.00      10.00
   TYR 161 A    15.30      10.00
   TYR 182 A    13.19      10.00
   LYS  12 A    10.42      10.50
   LYS  61 A    10.72      10.50
   LYS  88 A    10.14      10.50
   LYS  90 A    10.56      10.50
   LYS  97 A    10.37      10.50
   LYS 100 A    11.37      10.50
   LYS 102 A    10.77      10.50
   LYS 137 A    10.45      10.50
   ARG  40 A    14.21      12.50
   ARG  60 A    12.46      12.50
   ARG  76 A    12.59      12.50
   ARG 105 A    13.13      12.50
   ARG 131 A    13.28      12.50
   ARG 188 A    12.33      12.50
</code></pre></div></div>

<p>We can see that all the residues are in their usual protonation state, therefore we do not need to modify residue names in the PDB. If you perform this step using the <a href="http://biophysics.cs.vt.edu">H++ server</a>, it will give you the same information and also a new PDB file with the necessary changes applied.</p>

<blockquote class="callout">
  <h2 id="tip-1">TIP:</h2>

  <p><strong>Histidines</strong> are tricky residues, they have three possible protonation states: HID, HIE and HIP. HIP is the protonated residue. HID and HIE correspond to the two natural tautomers of the neutral histidine, where the proton can be found in <em>delta</em> or <em>epsilon</em> positions. In solution, the most common conformer is HIE but always visualise your structure before assuming any histidine protonation state.</p>

  <p><img src="../fig/H163.png" alt="three histidine states: HID HIE and HIP." /></p>
</blockquote>

<p>Last but not least, we need to clean the PDB file before passing it to AmberTools (removing residues with double ocupation, checking for disulfide bonds, …). So we are going to use the first AmberTools tool: <code class="language-plaintext highlighter-rouge">pdb4amber</code> which prepares your PDB file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdb4amber <span class="nt">-i</span> protein.pdb <span class="nt">-o</span> protein4amber.pdb  
</code></pre></div></div>

<p>It returns the following output:</p>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>==================================================
Summary of pdb4amber for: protein.pdb
===================================================

----------Chains
The following (original) chains have been found:
A

---------- Alternate Locations (Original Residues!))

The following residues had alternate locations:
VAL_73
-----------Non-standard-resnames


---------- Mising heavy atom(s)

None
The alternate coordinates have been discarded.
Only the first occurrence for each atom was kept.
</code></pre></div></div>

<p>The output above gives you a lot of information. First it tells you that your protein is composed of a single chain. Then it informs you that some residues had alternate conformations in the X-ray structure, but that only the first occurrence for each atom was kept.</p>

<p><code class="language-plaintext highlighter-rouge">pdb4amber</code> informs us about the duplicity of several sidechains, disulphide bonds and missing heavy atoms. However, it does not check protonation states for protein residues and therefore we <strong>ALWAYS</strong> must run a pKa calculation first and apply the required changes to the PDB.</p>

<hr />

<h3 id="assessing-the-protonation-states-of-the-ligand">Assessing the protonation states of the ligand</h3>

<p>So far we have not paid attention to the ligand. We will now move to check the protonation state of the  ligand. We have to check the pKa of the ligand. There are several options to do so, the most reliable one if available is <a href="https://pubchem.ncbi.nlm.nih.gov">PubChem</a>, where you can find experimental pKa values.</p>

<p>In this example, there are no pKa values (neither experimental nor calculated) reported for this molecule, so we need to use another resource. I like <a href="https://chemaxon.com/products/marvin">Marvin Sketch</a> because it is <em>free</em> to use <em>(you need to register and cannot use it for comercial purposes)</em>, it gives calculated pKa values and it has a nice visualisation of the chemical species at a different pH values.</p>

<p><img src="../fig/pKa_gws.png" alt="pKa calculation of the GWS ligand" /></p>

<p>After assessing the protonation state of the GWS ligand using Marvin Sketch, we can proceed to protonate it. The easiest way to protonate it is using <a href="http://openbabel.org">OpenBabel</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>obabel <span class="nt">-ipdb</span> GWS.pdb <span class="nt">-opdb</span> <span class="nt">-O</span> GWS.H.pdb <span class="nt">-h</span> 
</code></pre></div></div>

<p>You should always check the result of this step and ammend it if needed. In this case, it gives the protonation state predicted to be the most abundant by Marvinsketch at pH 7.4:</p>

<p><img src="../fig/GWS.png" alt="protonated GWS ligand" /></p>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p><code class="language-plaintext highlighter-rouge">pdb4amber</code> does a preliminary check on your PDB file and cleans potential errors in the protein structure.</p>
</li>
    
    <li><p>ALWAYS assess the protonation state of your system at the pH of interest.</p>
</li>
    
    <li><p><code class="language-plaintext highlighter-rouge">PROPKA</code> and <code class="language-plaintext highlighter-rouge">H++ server</code> predict the protonation state of each aminoacid of protein.</p>
</li>
    
    <li><p><code class="language-plaintext highlighter-rouge">openbabel</code> is a chemical toolbox designed to search, convert, analyze, or store data from molecular modeling, chemistry, biochemistry, or related areas.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-setup/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-parameters/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit//_episodes/03-prepPDB.md" data-checker-ignore>Edit on GitHub</a>
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:s.llabres@epcc.ed.ac.uk">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
